```
PROMPTING GRID EXPERIMENT ARCHITECTURE
═══════════════════════════════════════

┌─────────────────────────────────────────────────────────────────┐
│                    COMPUTE NODE (Mahti/Puhti)                   │
│              4× V100 GPUs | 16 CPUs | 128GB RAM                 │
└─────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┴─────────────────────┐
        │   run_prompting_experiments.py            │
        │   • Backend: CUDA (transformers)          │
        │   • Workers: 4 (round-robin GPU strategy) │
        │   • Model: Mistral-7B-Instruct-v0.2       │
        └───────────────────┬───────────────────────┘
                            │
     ┌──────────────────────┴──────────────────────┐
     │    Chunking: DSC (Dense Semantic Chunking)  │
     │    • Parent blocks: ~10-120 sentences       │
     │    • Child chunks: Semantic splitting       │
     │    • Heading-aware: Yes                     │
     └──────────────────────┬──────────────────────┘
                            │
        ┌───────────────────┴───────────────────┐
        │                                       │
   ┌────▼────┐  ┌────────┐  ┌──────────────┐  │
   │ 3M OEM  │  │ DOA    │  │ Fire Safety  │  │
   │ SOP     │  │ Food   │  │ Guideline    │  │
   │ (8.9KB) │  │ (28KB) │  │ (13.4KB)     │  │
   └────┬────┘  └───┬────┘  └──────┬───────┘  │
        │           │               │          │
        │           │               │          │
   ┌────▼───────────▼───────────────▼──────────▼┐
   │                                             │
   │         PROMPTING STRATEGIES (4)            │
   │                                             │
   │  P0: Zero-Shot JSON                         │
   │      • Single prompt, no examples           │
   │      • Baseline for comparison              │
   │                                             │
   │  P1: Few-Shot In-Context Learning           │
   │      • 2 annotated examples                 │
   │      • Demonstrates constraint types        │
   │      • Structured parameters                │
   │                                             │
   │  P2: Chain-of-Thought Reasoning             │
   │      • 4 reasoning stages:                  │
   │        1. CLASSIFY (descriptive/procedural) │
   │        2. FILTER (human actions only)       │
   │        3. ATTACH (constraints to steps)     │
   │        4. EMIT (structured JSON)            │
   │                                             │
   │  P3: Two-Stage Schema                       │
   │      • Stage 1: Extract steps only          │
   │      • Stage 2: Add constraints + entities  │
   │      • Validates constraint attachments     │
   │                                             │
   └────────────────┬────────────────────────────┘
                    │
                    │
   ┌────────────────▼────────────────────────────┐
   │         EXTRACTION OUTPUTS (12)             │
   │                                             │
   │  logs/prompting_grid/                       │
   │    ├── P0_zero_shot/                        │
   │    │   ├── 3M_OEM_SOP/predictions.json      │
   │    │   ├── DOA_Food_Proc/predictions.json   │
   │    │   └── op_firesafety/predictions.json   │
   │    ├── P1_few_shot/                         │
   │    │   └── ...                               │
   │    ├── P2_cot/                              │
   │    │   └── ...                               │
   │    └── P3_two_stage/                        │
   │        └── ...                               │
   │                                             │
   └────────────────┬────────────────────────────┘
                    │
                    │
   ┌────────────────▼────────────────────────────┐
   │          EVALUATION (A-TIER)                │
   │                                             │
   │  Metrics per (strategy × document):         │
   │                                             │
   │  • StepF1: Step text matching               │
   │  • AdjacencyF1: Sequential ordering         │
   │  • Kendall: Rank correlation                │
   │  • ConstraintCoverage: % constraints found  │
   │  • ConstraintAttachmentF1: Linking accuracy │
   │  • A_score: Weighted composite              │
   │                                             │
   │  Gold Standards:                            │
   │    ✓ 3M_OEM_SOP.json                        │
   │    ✓ DOA_Food_Man_Proc_Stor.json            │
   │    ✓ op_firesafety_guideline.json           │
   │                                             │
   └────────────────┬────────────────────────────┘
                    │
                    ▼
   ┌─────────────────────────────────────────────┐
   │          FINAL OUTPUT                       │
   │                                             │
   │  logs/prompting_grid/summary.csv            │
   │                                             │
   │  experiment | strategy | doc_id | StepF1 | │
   │  ─────────────────────────────────────────  │
   │  P0_zero_shot | P0 | 3M_OEM | 0.xx | ...   │
   │  P0_zero_shot | P0 | DOA_Food | 0.xx | ... │
   │  P0_zero_shot | P0 | op_fire | 0.xx | ...  │
   │  P1_few_shot | P1 | 3M_OEM | 0.xx | ...    │
   │  ...                                        │
   │  P3_two_stage | P3 | op_fire | 0.xx | ...  │
   │                                             │
   │  → 12 rows total (4 strategies × 3 docs)   │
   │  → Full A-tier metrics for comparison       │
   │                                             │
   └─────────────────────────────────────────────┘

═══════════════════════════════════════════════════

EXPERIMENT GOALS:
─────────────────
1. Compare extraction quality across 4 prompting approaches
2. Measure constraint-to-step attachment accuracy (critical fix validated)
3. Evaluate DSC chunking effectiveness on industrial procedures
4. Quantify A_score improvements from P0 (baseline) to P3 (advanced)
5. Identify optimal strategy for production deployment

EXPECTED RUNTIME: ~2-4 hours (with 4 GPUs in parallel)
EXPECTED OUTPUT: Clean CSV + 12 prediction JSONs + evaluation metrics
```
